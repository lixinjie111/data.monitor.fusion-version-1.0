webpackJsonp([2],{"+Nj6":function(t,e){},"4rTP":function(t,e){},"5NFV":function(t,e){},BNFx:function(t,e){},NIUJ:function(t,e){},Nzi2:function(t,e){},PDpb:function(t,e){},xCHB:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("tzsC"),s={data:function(){return{responseData:{}}},computed:{filterData:function(){var t={};for(var e in this.responseData)t[e]=parseFloat(this.responseData[e]).toLocaleString()||"--";return t}},methods:{getBaseStat:function(){var t=this;Object(i.a)().then(function(e){t.responseData=e.data})}},mounted:function(){this.getBaseStat()},destroyed:function(){}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fusion-left-style"},[a("div",{staticClass:"left-overview"},[a("ul",{staticClass:"left-item-wrapper"},[a("li",{staticClass:"left-item-list clearfix"},[a("i",{staticClass:"left-item-icon icon-1"}),t._v(" "),a("div",{staticClass:"left-item-text"},[a("p",{staticClass:"left-item-title"},[t._v("车辆总数")]),t._v(" "),a("p",{staticClass:"left-item-num"},[t._v(t._s(t.filterData.vehNum||"--"))])])]),t._v(" "),a("li",{staticClass:"left-item-list clearfix"},[a("i",{staticClass:"left-item-icon icon-2"}),t._v(" "),a("div",{staticClass:"left-item-text"},[a("p",{staticClass:"left-item-title"},[t._v("公路总里程数")]),t._v(" "),a("p",{staticClass:"left-item-num"},[t._v(t._s(t.filterData.roadToalMileage||"--"))])])]),t._v(" "),a("li",{staticClass:"left-item-list clearfix"},[a("i",{staticClass:"left-item-icon icon-3"}),t._v(" "),a("div",{staticClass:"left-item-text"},[a("p",{staticClass:"left-item-title"},[t._v("路侧点总数")]),t._v(" "),a("p",{staticClass:"left-item-num"},[t._v(t._s(t.filterData.rCUNum||"--"))])])]),t._v(" "),a("li",{staticClass:"left-item-list clearfix"},[a("i",{staticClass:"left-item-icon icon-4"}),t._v(" "),a("div",{staticClass:"left-item-text"},[a("p",{staticClass:"left-item-title"},[t._v("路侧设备总数")]),t._v(" "),a("p",{staticClass:"left-item-num"},[t._v(t._s(t.filterData.rCUDevNum||"--"))])])]),t._v(" "),a("li",{staticClass:"left-item-list clearfix"},[a("i",{staticClass:"left-item-icon icon-5"}),t._v(" "),a("div",{staticClass:"left-item-text"},[a("p",{staticClass:"left-item-title"},[t._v("红绿灯总数")]),t._v(" "),a("p",{staticClass:"left-item-num"},[t._v(t._s(t.filterData.spatNum||"--"))])])])])])])},staticRenderFns:[]};var o=a("VU/8")(s,n,!1,function(t){a("NIUJ")},"data-v-e41586de",null).exports,r=a("mvHQ"),c=a.n(r),l={x_PI:52.35987755982988,PI:3.141592653589793,a:6378245,ee:.006693421622965943,bd09togcj02:function(t,e){var a=52.35987755982988,i=t-.0065,s=e-.006,n=Math.sqrt(i*i+s*s)-2e-5*Math.sin(s*a),o=Math.atan2(s,i)-3e-6*Math.cos(i*a);return[n*Math.cos(o),n*Math.sin(o)]},gcj02tobd09:function(t,e){var a=Math.sqrt(t*t+e*e)+2e-5*Math.sin(e*this.x_PI),i=Math.atan2(e,t)+3e-6*Math.cos(t*this.x_PI);return[a*Math.cos(i)+.0065,a*Math.sin(i)+.006]},wgs84togcj02:function(t,e){if(this.out_of_china(t,e))return[t,e];var a=this.transformlat(t-105,e-35),i=this.transformlng(t-105,e-35),s=e/180*this.PI,n=Math.sin(s);n=1-this.ee*n*n;var o=Math.sqrt(n);return a=180*a/(this.a*(1-this.ee)/(n*o)*this.PI),[t+(i=180*i/(this.a/o*Math.cos(s)*this.PI)),e+a]},gcj02towgs84:function(t,e){if(this.out_of_china(t,e))return[t,e];var a=this.transformlat(t-105,e-35),i=this.transformlng(t-105,e-35),s=e/180*this.PI,n=Math.sin(s);n=1-this.ee*n*n;var o=Math.sqrt(n);return a=180*a/(this.a*(1-this.ee)/(n*o)*this.PI),[2*t-(t+(i=180*i/(this.a/o*Math.cos(s)*this.PI))),2*e-(e+a)]},transformlat:function(t,e){var a=2*t-100+3*e+.2*e*e+.1*t*e+.2*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,a+=2*(20*Math.sin(e*this.PI)+40*Math.sin(e/3*this.PI))/3,a+=2*(160*Math.sin(e/12*this.PI)+320*Math.sin(e*this.PI/30))/3},transformlng:function(t,e){var a=300+t+2*e+.1*t*t+.1*t*e+.1*Math.sqrt(Math.abs(t));return a+=2*(20*Math.sin(6*t*this.PI)+20*Math.sin(2*t*this.PI))/3,a+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,a+=2*(150*Math.sin(t/12*this.PI)+300*Math.sin(t/30*this.PI))/3},out_of_china:function(t,e){return t<72.004||t>137.8347||e<.8293||e>55.8271||!1}},h={name:"MapContainer",data:function(){return{id:"car-map-container",AMap:null,webSocket:null,webSocketData:{action:"vehicleOnline",token:"fpx",vehicleId:"vehicleOnline"},responseDataDraw:[],setFitViewFlag:!0,count:0,flag:!0,prevData:[],onlineConnectCount:0}},mounted:function(){var t=this;this.AMap=new AMap.Map(this.id,window.defaultMapOption),this.AMap.on("complete",function(){t.AMap.setMapStyle(window.defaultMapOption.mapStyle)}),this.initWebSocket();this.getDevDis(["2"])},methods:{initWebSocket:function(){try{"WebSocket"in window?(this.webSocket=new WebSocket(window.config.socketUrl),this.webSocket.onmessage=this.onmessage,this.webSocket.onclose=this.onclose,this.webSocket.onopen=this.onopen,this.webSocket.onerror=this.onerror):this.$message("此浏览器不支持websocket")}catch(t){this.carReconnect()}},onmessage:function(t){var e=this,a=JSON.parse(t.data).result.allVehicle;if(a.length>0){var i={};for(var s in a.forEach(function(t,e){i[t.vehicleId]={vehicleId:t.vehicleId,plateNo:t.plateNo,source:t.source.join(","),heading:t.heading,speed:t.speed,position:l.wgs84togcj02(t.longitude,t.latitude),marker:null,plateNoMarker:null}}),e.prevData)if(i[s]){i[s].marker=e.prevData[s].marker,i[s].plateNoMarker=e.prevData[s].plateNoMarker;var n=i[s];i[s].marker.setAngle(n.heading),i[s].marker.setPosition(n.position),i[s].plateNoMarker.setText(n.plateNo+"<br/><span style='color:#e6a23c'>"+n.source+"</span>"),i[s].plateNoMarker.setPosition(n.position)}else e.prevData[s].marker.off("click",e.showView),e.prevData[s].plateNoMarker.off("click",e.showView),e.AMap.remove(e.prevData[s].marker),e.AMap.remove(e.prevData[s].plateNoMarker),delete e.prevData[s];for(var o in i)e.prevData[o]||(e.addMarker(i[o]),e.addPlateNoMarker(i[o]));e.setFitViewFlag&&setTimeout(function(){e.AMap.setFitView(),e.setFitViewFlag=!1},500),e.prevData=i}else for(var r in e.prevData)e.prevData[r].marker.off("click",e.showView),e.prevData[r].plateNoMarker.off("click",e.showView),e.AMap.remove(e.prevData[r].marker),e.AMap.remove(e.prevData[r].plateNoMarker),delete e.prevData[r]},addMarker:function(t){t.marker=new AMap.Marker({map:this.AMap,position:t.position,icon:"static/images/car/point.png",offset:new AMap.Pixel(-2,-2),angle:t.heading,zIndex:50,vehicleId:t.vehicleId}),t.marker.on("click",this.showView)},addPlateNoMarker:function(t){t.plateNoMarker=new AMap.Text({map:this.AMap,text:t.plateNo+"<br/><span style='color:#e6a23c'>"+t.source+"</span>",anchor:"center",style:{padding:"0 5px","border-radius":"4px","background-color":"rgba(55, 186, 123, .2)","border-width":0,"text-align":"center","font-size":"10px","line-height":"16px","letter-spacing":"0","margin-top":"14px",color:"#ccc"},offset:new AMap.Pixel(0,-35),position:t.position,vehicleId:t.vehicleId,zIndex:60}),t.plateNoMarker.on("click",this.showView)},showView:function(t){this.$router.push({path:"/single/"+t.target.get("vehicleId"),query:{isCapture:!1}})},onclose:function(t){this.carReconnect()},onerror:function(){this.carReconnect()},onopen:function(t){this.sendMsg(c()(this.webSocketData))},sendMsg:function(t){window.WebSocket&&this.webSocket.readyState==WebSocket.OPEN&&this.webSocket.send(t)},carReconnect:function(){this._isDestroyed||this.onlineConnectCount>=10||(this.initWebSocket(),this.onlineConnectCount++)},getDevDis:function(t){var e=this;Object(i.b)({devTypes:t}).then(function(t){e.deviceMap(t.data),sessionStorage.setItem("sideList",c()(t.data))})},deviceMap:function(t){var e=this;if(0==e.count&&t.length>0){var a=[];t.forEach(function(t){var e=void 0;(t.longitude||t.latitude)&&(e={position:new AMap.LngLat(t.longitude,t.latitude),type:t.type,deviceId:t.deviceId,path:t.path,longitude:t.longitude,latitude:t.latitude,title:t.devName},a.push(e))}),a.forEach(function(t,i,s){a[i].position=l.wgs84togcj02(t.longitude,t.latitude),e.count++,e.count==s.length&&a.forEach(function(t,i){if(2==t.type){var s=new AMap.Marker({position:t.position,icon:"static/images/road/side.png",offset:new AMap.Pixel(-15,-15),title:t.title});e.AMap.add(s);t.path,t.deviceId;s.on("click",function(a){e.$router.push({path:"/perception/"+t.deviceId+"/1/0.002/"+!0,query:{lng:t.longitude,lat:t.latitude,isShow:!1,isCapture:!1}})})}i==a.length-1&&(e.AMap.setFitView(),e.count=0)})})}}},destroyed:function(){this.webSocket&&this.webSocket.close()}},d={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"road-view-map",attrs:{id:this.id}})},staticRenderFns:[]};var p=a("VU/8")(h,d,!1,function(t){a("5NFV"),a("Nzi2")},"data-v-3f8073bc",null).exports,u={name:"RightList",data:function(){return{items:"nihao",vehicleIds:"B21E-00-017,B21E-00-018,B21E-00-019,B21E-00-020",responseData:[],webSocket:null,webSocketData:{action:"can_real_data",token:"fpx",vehicleIds:"B21E-00-017,B21E-00-018,B21E-00-019,B21E-00-020",canConnectCount:0}}},mounted:function(){this.getGpsRealConfig()},methods:{getGpsRealConfig:function(){var t=this;Object(i.c)().then(function(e){t.vehicleIds=e.data,t.webSocketData.vehicleIds=e.data,t.initWebSocket()})},getGpsRealList:function(){var t=this;Object(i.d)({vehicleId:this.vehicleIds}).then(function(e){e.data.forEach(function(e){t.initResult(e.vehicleId,e)})})},initResult:function(t,e){var a={};a.vehicleId=e.vehicleId,a.transmission=e.transmission,"P"!=e.transmission?a.speed=e.speed:a.speed=0,a.headingAngle=e.headingAngle,a.turnLight=e.turnLight,a.autoLevel=e.autoLevel,a.vehicleLogo=e.vehicleLogo,a.plateNo=e.plateNo,this.responseData.push(a)},initWebSocket:function(){try{"WebSocket"in window?(this.webSocket=new WebSocket(window.config.websocketUrl),this.webSocket.onmessage=this.onmessage,this.webSocket.onclose=this.onclose,this.webSocket.onopen=this.onopen,this.webSocket.onerror=this.onerror):this.$message("此浏览器不支持websocket")}catch(t){this.canReconnect()}},onmessage:function(t){var e=JSON.parse(t.data).result,a=e.vehicleId;this.responseData.forEach(function(t,i){t.vehicleId===a&&(t.transmission=e.transmission,"P"!=e.transmission?(t.speed=e.speed,t.headingAngle=e.headingAngle,t.turnLight=e.turnLight):t.speed=0)})},onclose:function(t){this.canReconnect()},onerror:function(){this.canReconnect()},onopen:function(t){this.sendMsg(c()(this.webSocketData))},sendMsg:function(t){window.WebSocket&&this.webSocket.readyState==WebSocket.OPEN&&(this.webSocket.send(t),this.getGpsRealList())},canReconnect:function(){this._isDestroyed||this.canConnectCount>=10||(this.initWebSocket(),this.canConnectCount++)},showView:function(t){this.$router.push({path:"/single/"+t,query:{isCapture:!1}})}},destroyed:function(){this.webSocket&&this.webSocket.close()}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"bottom-overview"},t._l(t.responseData,function(e,i){return a("li",{key:e.vehicleId,staticClass:"car-info-li",on:{click:function(a){return t.showView(e.vehicleId)}}},[a("div",{staticClass:"car-info"},[a("span",{staticClass:"car-index"},[t._v(t._s(i+1))])]),t._v(" "),a("div",{staticClass:"car-detail"},[a("img",{staticClass:"car-img",attrs:{src:e.vehicleLogo}})]),t._v(" "),a("div",{staticClass:"car-detail-info"},[a("p",{staticClass:"car-plate"},[t._v(t._s(e.plateNo))]),t._v(" "),a("div",{staticClass:"driving-info"},[a("span",{staticClass:"driving-level"},[t._v("L"+t._s(e.autoLevel))]),t._v(" "),a("span",{staticClass:"driving-trans"},[t._v(t._s(e.transmission))]),t._v(" "),a("span",{staticClass:"direction",style:{transform:"rotate("+e.headingAngle+"deg)"}})])])])}),0)},staticRenderFns:[]};var v=a("VU/8")(u,f,!1,function(t){a("+Nj6")},"data-v-8daed682",null).exports,g=a("woOf"),m=a.n(g),k={props:{id:String,mapData:Object},data:function(){return{aMap:null,wms:{},mapRoadData:this.mapData,crossData:{roadLights:[],roadSenseCars:[],finalFourPosition:[],sideVehicleObj:{},sideLight:{}},mapPointData:[],roadWebSocket:null,carWebSocket:null,prevData:{},platformConnectCount:0,spatConnectCount:0}},mounted:function(){var t=this,e=m()({},window.mapOption,{zoom:18,dragEnable:!1});this.aMap=new AMap.Map(this.id,e),this.aMap.on("complete",function(){t.aMap.setMapStyle(window.mapOption.mapStyleEmpty)}),this.drawRoadMap()},methods:{drawRoadMap:function(){var t=new AMap.LngLat(this.mapRoadData.longitude,this.mapRoadData.latitude),e=(this.mapRoadData.longitude,this.mapRoadData.latitude,m()({},window.dlWmsDefaultOption,{params:{LAYERS:window.dlWmsOption.LAYERS_gjlk,VERSION:window.dlWmsOption.VERSION}}));this.wms=new AMap.TileLayer.WMS(e),this.wms.setMap(this.aMap),this.aMap.setCenter(t),this.aMap.setStatus({zoomEnable:!1}),this.getFourPosition(),this.initWebsocket(),this.initCarWebsocket()},getFourPosition:function(){var t=this.getExtend(this.mapRoadData.longitude,this.mapRoadData.latitude,.001);this.crossData.finalFourPosition=t},getExtend:function(t,e,a){var i=[],s=t+a,n=e+a,o=t-a,r=e-a;return i.push([o,n]),i.push([s,n]),i.push([s,r]),i.push([o,r]),i},initCarWebsocket:function(){try{"WebSocket"in window?(this.carWebSocket=new WebSocket(window.config.websocketUrl),this.carWebSocket.onmessage=this.onCarMessage,this.carWebSocket.onclose=this.onCarClose,this.carWebSocket.onopen=this.onCarOpen,this.carWebSocket.onerror=this.onCarError):this.$message("此浏览器不支持websocket")}catch(t){this.carReconnect()}},onCarMessage:function(t){var e=JSON.parse(t.data).result;if("vehDataDTO"in e==!0)if(this.crossData.roadSenseCars=e.vehDataDTO,this.crossData.roadSenseCars.length>0){this.crossData.roadSenseCars=this.crossData.roadSenseCars.filter(function(t){return 2===t.targetType||5===t.targetType});var a={};for(var i in this.crossData.roadSenseCars.forEach(function(t,e){a[t.vehicleId]={longitude:t.longitude,latitude:t.latitude,heading:t.heading,speed:t.speed,vehicleId:t.vehicleId,devId:t.devId,marker:null,plateNo:t.plateNo}}),this.prevData)if(a[i]){a[i].marker=this.prevData[i].marker;var s=a[i];a[i].marker.setAngle(s.heading),a[i].marker.setPosition([s.longitude,s.latitude])}else this.aMap.remove(this.prevData[i].marker),delete this.prevData[i];for(var n in a)this.prevData[n]||(a[n].marker=new AMap.Marker({position:[a[n].longitude,a[n].latitude],map:this.aMap,icon:"static/images/road/car.png",angle:a[n].heading,devId:a[n].devId,offset:new AMap.Pixel(-4,-9),zIndex:1}));this.prevData=a}else for(var o in this.prevData)this.prevData[o].marker.stopMove(),this.aMap.remove(this.prevData[o].marker),delete this.prevData[o]},onCarClose:function(t){this.carReconnect()},onCarError:function(t){this.carReconnect()},onCarOpen:function(t){var e={action:"road_real_data_reg",data:{polygon:this.crossData.finalFourPosition,fuselType:1}},a=c()(e);this.sendCarMsg(a)},sendCarMsg:function(t){window.WebSocket&&this.carWebSocket.readyState==WebSocket.OPEN&&this.carWebSocket.send(t)},carReconnect:function(){this._isDestroyed||this.platformConnectCount>=10||(this.initCarWebsocket(),this.platformConnectCount++)},initWebsocket:function(){try{"WebSocket"in window?(this.roadWebSocket=new WebSocket(window.config.websocketUrl),this.roadWebSocket.onmessage=this.onMessage,this.roadWebSocket.onclose=this.onClose,this.roadWebSocket.onopen=this.onOpen,this.roadWebSocket.onerror=this.onError):this.$message("此浏览器不支持websocket")}catch(t){this.spatReconnect()}},onMessage:function(t){var e=this,a=this,i=JSON.parse(t.data).result;if("spatDataDTO"in i==!0&&(a.crossData.roadLights=i.spatDataDTO,a.crossData.roadLights.length>0)){for(var s in a.crossData.sideLight){for(var n=!1,o=0;o<a.crossData.roadLights.length;o++)if(s===a.crossData.roadLights[o].spatId&&a.crossData.sideLight[s].flag){n=!0;break}n||(a.crossData.sideLight[s].flag=!1)}a.crossData.roadLights.forEach(function(t,i,s){a.crossData.sideLight[t.spatId]?a.crossData.sideLight[t.spatId].marker.setIcon(e.dealLight(t)):(a.crossData.sideLight[t.spatId]={marker:null,flag:!0},a.crossData.sideLight[t.spatId].marker=new AMap.Marker({position:[t.position.longitude,t.position.latitude],map:a.aMap,icon:e.dealLight(t),spatId:t.spatId,offset:new AMap.Pixel(-2,-5),zIndex:100}),a.aMap.add(a.crossData.sideLight[t.spatId].marker))})}},onClose:function(t){this.spatReconnect()},onError:function(){this.spatReconnect()},onOpen:function(t){var e={action:"road_real_data_spat",data:{polygon:this.crossData.finalFourPosition,fuselType:1}},a=c()(e);this.sendMsg(a)},sendMsg:function(t){window.WebSocket&&this.roadWebSocket.readyState==WebSocket.OPEN&&this.roadWebSocket.send(t)},spatReconnect:function(){this._isDestroyed||this.spatConnectCount>=10||(this.initWebsocket(),this.spatConnectCount++)},dealLight:function(t){return"status"in t!=!0?"static/images/road/green.jpg":"RED"===t.status?"static/images/road/red.jpg":"YELLOW"===t.status?"static/images/road/yellow.jpg":"GREEN"===t.status?"static/images/road/green.jpg":void 0}},destroyed:function(){this.roadWebSocket&&this.roadWebSocket.close(),this.carWebSocket&&this.carWebSocket.close()}},w={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"road-scan",attrs:{id:this.id}})])},staticRenderFns:[]};var M={components:{RoadSection:a("VU/8")(k,w,!1,function(t){a("PDpb")},null,null).exports},data:function(){return{centerPointData:[]}},mounted:function(){this.fetchTypicalRoad()},methods:{showRoadDetail:function(t){var e=t.centPos.split(",");this.$router.push({path:"/perception/"+t.rsId+"/1/0.002/"+!0,query:{lng:e[0],lat:e[1],isShow:!1,isCapture:!1}})},fetchTypicalRoad:function(){var t=this;Object(i.e)().then(function(e){var a=e.data;t.centerPointData=a.slice(0,4)})}},destroyed:function(){}},C={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-fusion-right right-road"},t._l(t.centerPointData,function(e,i){return a("div",{key:i,staticClass:"perception-road"},[a("div",{staticClass:"road-word",on:{click:function(a){return t.showRoadDetail(e)}}},[a("p",[t._v(t._s(e.rsName))])]),t._v(" "),a("road-section",{staticClass:"cross-scan",attrs:{id:"map"+i,mapData:e}})],1)}),0)},staticRenderFns:[]};var b={components:{LeftOverview:o,MapContainer:p,BottomOverview:v,SpecialRoad:a("VU/8")(M,C,!1,function(t){a("BNFx")},"data-v-14179a6d",null).exports,HeaderTop:a("JCuE").a},data:function(){return{}},methods:{},mounted:function(){},destroyed:function(){}},D={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fusion-style"},[e("div",{staticClass:"c-fusion-left fusion-left"},[e("div",{staticClass:"c-scroll-wrap"},[e("div",{staticClass:"c-scroll-inner"},[e("left-overview")],1)])]),this._v(" "),e("map-container"),this._v(" "),e("special-road"),this._v(" "),e("div",{staticClass:"fusion-bottom"},[e("bottom-overview")],1)],1)},staticRenderFns:[]};var S=a("VU/8")(b,D,!1,function(t){a("4rTP")},"data-v-da35f0ee",null);e.default=S.exports}});